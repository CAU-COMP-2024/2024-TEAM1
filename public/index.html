<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>앱 테스트</title>
</head>
<body>
  <h1>앱 간단 테스트</h1>

  <!-- 스크린샷 업로드 폼 -->
  <form id="upload-form">
    <label for="file">대화 스크린샷 업로드:</label>
    <input type="file" id="file" name="screenshot" accept="image/*" required />
    <button type="submit">전송</button>
  </form>

  <div id="upload-result"></div>

  <hr />

  <!-- 텍스트 프롬프트 입력 폼 -->
  <form id="prompt-form">
    <label for="promptInput">대화 상황/프롬프트 입력:</label><br>
    <textarea id="promptInput" rows="4" cols="50" placeholder="예) 상대가 '오늘 뭐했어?'라고 물어봤는데 어떤 답변이 좋을까?"></textarea><br>
    <button type="submit">전송</button>
  </form>

  <div id="prompt-result"></div>

  <script>
    const uploadForm = document.getElementById('upload-form');
    const uploadResultDiv = document.getElementById('upload-result');
    const promptForm = document.getElementById('prompt-form');
    const promptResultDiv = document.getElementById('prompt-result');

    // 1) 스크린샷 업로드 시
    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      uploadResultDiv.innerHTML = '처리 중...';

      const fileInput = document.getElementById('file');
      const formData = new FormData();
      formData.append('screenshot', fileInput.files[0]);

      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: formData,
        });
        const data = await response.json();

        if (data.error) {
          uploadResultDiv.innerHTML = `오류: ${data.error}`;
        } else {
          uploadResultDiv.innerHTML = `AI 추천 메시지: ${data.message}`;
        }
      } catch (err) {
        console.error(err);
        uploadResultDiv.innerHTML = '서버 오류가 발생했습니다.';
      }
    });

    // 2) 텍스트 프롬프트 직접 입력 시
    promptForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      promptResultDiv.innerHTML = '처리 중...';

      const userInput = document.getElementById('promptInput').value;
      try {
        const response = await fetch('/prompt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userInput }),
        });
        const data = await response.json();

        if (data.error) {
          promptResultDiv.innerHTML = `오류: ${data.error}`;
        } else {
          promptResultDiv.innerHTML = `AI 추천 메시지: ${data.message}`;
        }
      } catch (err) {
        console.error(err);
        promptResultDiv.innerHTML = '서버 오류가 발생했습니다.';
      }
    });
  </script>
</body>
</html>
